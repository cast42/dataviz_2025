<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/apple-touch-icon.png" />
    <link rel="manifest" crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>tree_map.py</marimo-filename>
    <!-- TODO(Trevor): Legacy, required by VS Code plugin. Remove when plugin is updated (see marimo/server/_templates/template.py) -->
    <marimo-version data-version="{{ version }}" hidden></marimo-version>
    <marimo-user-config data-config="{{ user_config }}" hidden></marimo-user-config>
    <marimo-server-token data-token="{{ server_token }}" hidden></marimo-server-token>
    <!-- /TODO -->
    <title>tree map</title>
    <script type="module" crossorigin crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/index-OC46250R.js"></script>
    <link rel="stylesheet" crossorigin crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/@marimo-team/frontend@0.15.5/dist/assets/index-CknhX2Vy.css">
  
<script data-marimo="true">
    window.__MARIMO_STATIC__ = {};
    window.__MARIMO_STATIC__.files = {};
</script>
</head>
  <body>
    <div id="root"></div>
    <!-- This is a portal for the data editor to render in -->
    <div id="portal" data-testid="glide-portal" style="position: fixed; left: 0; top: 0; z-index: 9999"></div>
    <script data-marimo="true">
      window.__MARIMO_MOUNT_CONFIG__ = {
            "filename": "tree_map.py",
            "mode": "read",
            "version": "0.15.5",
            "serverToken": "static",
            "config": {"ai": {"models": {"custom_models": [], "displayed_models": []}}, "completion": {"activate_on_typing": true, "copilot": false}, "display": {"cell_output": "above", "code_editor_font_size": 14, "dataframes": "rich", "default_table_max_columns": 50, "default_table_page_size": 10, "default_width": "medium", "reference_highlighting": false, "theme": "light"}, "formatting": {"line_length": 79}, "keymap": {"overrides": {}, "preset": "default"}, "language_servers": {"pylsp": {"enable_flake8": false, "enable_mypy": true, "enable_pydocstyle": false, "enable_pyflakes": false, "enable_pylint": false, "enable_ruff": true, "enabled": true}}, "package_management": {"manager": "uv"}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "default_sql_output": "auto", "on_cell_change": "autorun", "output_max_bytes": 8000000, "reactive_tests": true, "std_stream_max_bytes": 1000000, "watcher_on_save": "lazy"}, "save": {"autosave": "after_delay", "autosave_delay": 1000, "format_on_save": false}, "server": {"browser": "default", "follow_symlink": false}, "snippets": {"custom_paths": [], "include_default_snippets": true}},
            "configOverrides": {},
            "appConfig": {"sql_output": "auto", "width": "medium"},
            "view": {"showAppCode": true},
            "notebook": {"cells": [{"code": "import duckdb\nimport altair as alt\n\ncon = duckdb.connect()\nSQL = ''' SELECT * FROM read_parquet('data/sales_stores_hierarchy_merged.parquet'); '''\ncon.sql(SQL).to_view(\"SALES\")\ncon.sql('describe SALES ').show()", "code_hash": "1cd002ff3e99ebb021b0979dabca59a6", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "Hbol", "name": "_"}, {"code": "query = \"\"\"\nSELECT\n    hierarchy1_id,\n    SUM(revenue) AS total_revenue\nFROM read_parquet('data/sales_stores_hierarchy_merged.parquet')\nGROUP BY hierarchy1_id\n\"\"\"", "code_hash": "508a23fb23965508080f6e221b5ca437", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "MJUe", "name": "_"}, {"code": "df = con.execute(query).fetchdf()\ndf", "code_hash": "4492a2eb300e0dfc2263a85a889a2a43", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "vblA", "name": "_"}, {"code": "print(df.to_markdown(index=False))", "code_hash": "34301c615eaf0e4149493338e4ac3a36", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "bkHC", "name": "_"}, {"code": "import squarify\n\nvalues = df[\"total_revenue\"].tolist()\nnormed = squarify.normalize_sizes(values, 100, 100)\nrects = squarify.squarify(normed, 0, 0, 100, 100)\n\n# Add rectangle info to dataframe\nfor i, r in enumerate(rects):\n    df.loc[i, \"x\"] = r['x']\n    df.loc[i, \"y\"] = r['y']\n    df.loc[i, \"dx\"] = r['dx']\n    df.loc[i, \"dy\"] = r['dy']\n\ndf[\"x2\"] = df[\"x\"] + df[\"dx\"]\ndf[\"y2\"] = df[\"y\"] + df[\"dy\"]\n\n# Now plot with Altair\nchart = (\n    alt.Chart(df)\n    # Get the grand total once and attach it to every row\n    .transform_joinaggregate(\n        total_sum='sum(total_revenue)'\n    )\n    # Compute a formatted percent string like \"27%\"\n    .transform_calculate(\n        share=\"format(datum.total_revenue / datum.total_sum, '.0%')\"\n    )\n    .mark_rect()\n    .encode(\n        x=alt.X(\"x:Q\", scale=alt.Scale(domain=[0, 100]), axis=None),\n        y=alt.Y(\"y:Q\", scale=alt.Scale(domain=[0, 100]), axis=None),\n        x2=\"x2:Q\",\n        y2=\"y2:Q\",\n        color=\"total_revenue:Q\",\n        tooltip=[\n            alt.Tooltip(\"hierarchy1_id:N\", title=\"Category\"),\n            alt.Tooltip(\"total_revenue:Q\", title=\"Revenue (\u20ac)\", format=\",.0f\"),\n            alt.Tooltip(\"share:N\", title=\"Share\"),  # e.g. \"27%\"\n        ],\n    )\n    # .properties(width=500, height=500)\n    .properties(title=\"Relatieve total revenue for hierarchy1\")\n    .configure_title(\n        fontSize=34,     # increase size\n        anchor=\"start\",  # or \"middle\" for centered\n        fontWeight=\"bold\"\n    )\n)\n\nchart", "code_hash": "2f24729373d75c0dc7c583d97764622d", "config": {"column": null, "disabled": false, "hide_code": false}, "id": "lEQa", "name": "_"}, {"code": "", "code_hash": null, "config": {"column": null, "disabled": false, "hide_code": false}, "id": "PKri", "name": "_"}], "metadata": {"marimo_version": "0.15.5"}, "version": "1"},
            "session": {"cells": [{"code_hash": "1cd002ff3e99ebb021b0979dabca59a6", "console": [{"name": "stdout", "text": "\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    column_name    \u2502 column_type \u2502  null   \u2502   key   \u2502 default \u2502  extra  \u2502\n\u2502      varchar      \u2502   varchar   \u2502 varchar \u2502 varchar \u2502 varchar \u2502 varchar \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 product_id        \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 store_id          \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 date              \u2502 TIMESTAMP   \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 sales             \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 revenue           \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 stock             \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 price             \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 promo_type_1      \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 promo_bin_1       \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 promo_type_2      \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502      \u00b7            \u2502   \u00b7         \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502\n\u2502      \u00b7            \u2502   \u00b7         \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502\n\u2502      \u00b7            \u2502   \u00b7         \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502  \u00b7      \u2502\n\u2502 product_length    \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 product_depth     \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 product_width     \u2502 DOUBLE      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 cluster_id        \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 hierarchy1_id     \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 hierarchy2_id     \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 hierarchy3_id     \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 hierarchy4_id     \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 hierarchy5_id     \u2502 VARCHAR     \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u2502 __index_level_0__ \u2502 BIGINT      \u2502 YES     \u2502 NULL    \u2502 NULL    \u2502 NULL    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 32 rows (20 shown)                                            6 columns \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n", "type": "stream"}], "id": "Hbol", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "508a23fb23965508080f6e221b5ca437", "console": [], "id": "MJUe", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "4492a2eb300e0dfc2263a85a889a2a43", "console": [], "id": "vblA", "outputs": [{"data": {"text/html": "<marimo-ui-element object-id='vblA-0' random-id='a57e4bf2-0c82-4618-35ea-1bc455787640'><marimo-table data-initial-value='[]' data-label='null' data-data='&quot;[{&#92;&quot;hierarchy1_id&#92;&quot;:&#92;&quot;H03&#92;&quot;,&#92;&quot;total_revenue&#92;&quot;:5669057.14000066},{&#92;&quot;hierarchy1_id&#92;&quot;:&#92;&quot;H02&#92;&quot;,&#92;&quot;total_revenue&#92;&quot;:429366.4100000094},{&#92;&quot;hierarchy1_id&#92;&quot;:&#92;&quot;H00&#92;&quot;,&#92;&quot;total_revenue&#92;&quot;:20056764.762010098},{&#92;&quot;hierarchy1_id&#92;&quot;:&#92;&quot;H01&#92;&quot;,&#92;&quot;total_revenue&#92;&quot;:11545048.249004468}]&quot;' data-total-rows='4' data-total-columns='2' data-max-columns='50' data-banner-text='&quot;&quot;' data-pagination='true' data-page-size='10' data-field-types='[[&quot;hierarchy1_id&quot;,[&quot;string&quot;,&quot;object&quot;]],[&quot;total_revenue&quot;,[&quot;number&quot;,&quot;float64&quot;]]]' data-show-filters='true' data-show-download='true' data-show-column-summaries='false' data-show-data-types='true' data-show-page-size-selector='false' data-show-column-explorer='true' data-show-chart-builder='true' data-row-headers='[]' data-has-stable-row-id='false' data-lazy='false' data-preload='false'></marimo-table></marimo-ui-element>"}, "type": "data"}]}, {"code_hash": "34301c615eaf0e4149493338e4ac3a36", "console": [{"name": "stdout", "text": "| hierarchy1_id   |    total_revenue |\n|:----------------|-----------------:|\n| H03             |      5.66906e+06 |\n| H02             | 429366           |\n| H00             |      2.00568e+07 |\n| H01             |      1.1545e+07  |\n", "type": "stream"}], "id": "bkHC", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}, {"code_hash": "2f24729373d75c0dc7c583d97764622d", "console": [], "id": "lEQa", "outputs": [{"data": {"application/vnd.vegalite.v5+json": "{\n  \"$schema\": \"https://vega.github.io/schema/vega-lite/v5.20.1.json\",\n  \"config\": {\n    \"title\": {\n      \"anchor\": \"start\",\n      \"fontSize\": 34,\n      \"fontWeight\": \"bold\"\n    },\n    \"view\": {\n      \"continuousHeight\": 300,\n      \"continuousWidth\": 300\n    }\n  },\n  \"data\": {\n    \"name\": \"data-d2ae8ee36c50abebed9e91868160fe23\"\n  },\n  \"datasets\": {\n    \"data-d2ae8ee36c50abebed9e91868160fe23\": [\n      {\n        \"dx\": 16.176088285628634,\n        \"dy\": 92.95938685662524,\n        \"hierarchy1_id\": \"H03\",\n        \"total_revenue\": 5669057.14000066,\n        \"x\": 0.0,\n        \"x2\": 16.176088285628634,\n        \"y\": 0.0,\n        \"y2\": 92.95938685662524\n      },\n      {\n        \"dx\": 16.176088285628634,\n        \"dy\": 7.040613143374771,\n        \"hierarchy1_id\": \"H02\",\n        \"total_revenue\": 429366.4100000094,\n        \"x\": 0.0,\n        \"x2\": 16.176088285628634,\n        \"y\": 92.95938685662524,\n        \"y2\": 100.00000000000001\n      },\n      {\n        \"dx\": 83.82391171437136,\n        \"dy\": 63.46713321485534,\n        \"hierarchy1_id\": \"H00\",\n        \"total_revenue\": 20056764.762010098,\n        \"x\": 16.176088285628634,\n        \"x2\": 100.0,\n        \"y\": 0.0,\n        \"y2\": 63.46713321485534\n      },\n      {\n        \"dx\": 83.82391171437139,\n        \"dy\": 36.53286678514466,\n        \"hierarchy1_id\": \"H01\",\n        \"total_revenue\": 11545048.249004468,\n        \"x\": 16.176088285628634,\n        \"x2\": 100.00000000000003,\n        \"y\": 63.46713321485534,\n        \"y2\": 100.0\n      }\n    ]\n  },\n  \"encoding\": {\n    \"color\": {\n      \"field\": \"total_revenue\",\n      \"type\": \"quantitative\"\n    },\n    \"tooltip\": [\n      {\n        \"field\": \"hierarchy1_id\",\n        \"title\": \"Category\",\n        \"type\": \"nominal\"\n      },\n      {\n        \"field\": \"total_revenue\",\n        \"format\": \",.0f\",\n        \"title\": \"Revenue (\\u20ac)\",\n        \"type\": \"quantitative\"\n      },\n      {\n        \"field\": \"share\",\n        \"title\": \"Share\",\n        \"type\": \"nominal\"\n      }\n    ],\n    \"x\": {\n      \"axis\": null,\n      \"field\": \"x\",\n      \"scale\": {\n        \"domain\": [\n          0,\n          100\n        ]\n      },\n      \"type\": \"quantitative\"\n    },\n    \"x2\": {\n      \"field\": \"x2\"\n    },\n    \"y\": {\n      \"axis\": null,\n      \"field\": \"y\",\n      \"scale\": {\n        \"domain\": [\n          0,\n          100\n        ]\n      },\n      \"type\": \"quantitative\"\n    },\n    \"y2\": {\n      \"field\": \"y2\"\n    }\n  },\n  \"mark\": {\n    \"type\": \"rect\"\n  },\n  \"title\": \"Relatieve total revenue for hierarchy1\",\n  \"transform\": [\n    {\n      \"joinaggregate\": [\n        {\n          \"as\": \"total_sum\",\n          \"field\": \"total_revenue\",\n          \"op\": \"sum\"\n        }\n      ]\n    },\n    {\n      \"as\": \"share\",\n      \"calculate\": \"format(datum.total_revenue / datum.total_sum, '.0%')\"\n    }\n  ],\n  \"usermeta\": {\n    \"embedOptions\": {}\n  },\n  \"width\": \"container\"\n}"}, "type": "data"}]}, {"code_hash": null, "console": [], "id": "PKri", "outputs": [{"data": {"text/plain": ""}, "type": "data"}]}], "metadata": {"marimo_version": "0.15.5"}, "version": "1"},
            "runtimeConfig": null,
        };
    </script>
  
<marimo-code hidden="">
    import%20marimo%0A%0A__generated_with%20%3D%20%220.15.5%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20duckdb%0A%20%20%20%20import%20altair%20as%20alt%0A%0A%20%20%20%20con%20%3D%20duckdb.connect()%0A%20%20%20%20SQL%20%3D%20'''%20SELECT%20*%20FROM%20read_parquet('data%2Fsales_stores_hierarchy_merged.parquet')%3B%20'''%0A%20%20%20%20con.sql(SQL).to_view(%22SALES%22)%0A%20%20%20%20con.sql('describe%20SALES%20').show()%0A%20%20%20%20return%20alt%2C%20con%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20query%20%3D%20%22%22%22%0A%20%20%20%20SELECT%0A%20%20%20%20%20%20%20%20hierarchy1_id%2C%0A%20%20%20%20%20%20%20%20SUM(revenue)%20AS%20total_revenue%0A%20%20%20%20FROM%20read_parquet('data%2Fsales_stores_hierarchy_merged.parquet')%0A%20%20%20%20GROUP%20BY%20hierarchy1_id%0A%20%20%20%20%22%22%22%0A%20%20%20%20return%20(query%2C)%0A%0A%0A%40app.cell%0Adef%20_(con%2C%20query)%3A%0A%20%20%20%20df%20%3D%20con.execute(query).fetchdf()%0A%20%20%20%20df%0A%20%20%20%20return%20(df%2C)%0A%0A%0A%40app.cell%0Adef%20_(df)%3A%0A%20%20%20%20print(df.to_markdown(index%3DFalse))%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_(alt%2C%20df)%3A%0A%20%20%20%20import%20squarify%0A%0A%20%20%20%20values%20%3D%20df%5B%22total_revenue%22%5D.tolist()%0A%20%20%20%20normed%20%3D%20squarify.normalize_sizes(values%2C%20100%2C%20100)%0A%20%20%20%20rects%20%3D%20squarify.squarify(normed%2C%200%2C%200%2C%20100%2C%20100)%0A%0A%20%20%20%20%23%20Add%20rectangle%20info%20to%20dataframe%0A%20%20%20%20for%20i%2C%20r%20in%20enumerate(rects)%3A%0A%20%20%20%20%20%20%20%20df.loc%5Bi%2C%20%22x%22%5D%20%3D%20r%5B'x'%5D%0A%20%20%20%20%20%20%20%20df.loc%5Bi%2C%20%22y%22%5D%20%3D%20r%5B'y'%5D%0A%20%20%20%20%20%20%20%20df.loc%5Bi%2C%20%22dx%22%5D%20%3D%20r%5B'dx'%5D%0A%20%20%20%20%20%20%20%20df.loc%5Bi%2C%20%22dy%22%5D%20%3D%20r%5B'dy'%5D%0A%0A%20%20%20%20df%5B%22x2%22%5D%20%3D%20df%5B%22x%22%5D%20%2B%20df%5B%22dx%22%5D%0A%20%20%20%20df%5B%22y2%22%5D%20%3D%20df%5B%22y%22%5D%20%2B%20df%5B%22dy%22%5D%0A%0A%20%20%20%20%23%20Now%20plot%20with%20Altair%0A%20%20%20%20chart%20%3D%20(%0A%20%20%20%20%20%20%20%20alt.Chart(df)%0A%20%20%20%20%20%20%20%20%23%20Get%20the%20grand%20total%20once%20and%20attach%20it%20to%20every%20row%0A%20%20%20%20%20%20%20%20.transform_joinaggregate(%0A%20%20%20%20%20%20%20%20%20%20%20%20total_sum%3D'sum(total_revenue)'%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%23%20Compute%20a%20formatted%20percent%20string%20like%20%2227%25%22%0A%20%20%20%20%20%20%20%20.transform_calculate(%0A%20%20%20%20%20%20%20%20%20%20%20%20share%3D%22format(datum.total_revenue%20%2F%20datum.total_sum%2C%20'.0%25')%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20.mark_rect()%0A%20%20%20%20%20%20%20%20.encode(%0A%20%20%20%20%20%20%20%20%20%20%20%20x%3Dalt.X(%22x%3AQ%22%2C%20scale%3Dalt.Scale(domain%3D%5B0%2C%20100%5D)%2C%20axis%3DNone)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y%3Dalt.Y(%22y%3AQ%22%2C%20scale%3Dalt.Scale(domain%3D%5B0%2C%20100%5D)%2C%20axis%3DNone)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20x2%3D%22x2%3AQ%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20y2%3D%22y2%3AQ%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20color%3D%22total_revenue%3AQ%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20tooltip%3D%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.Tooltip(%22hierarchy1_id%3AN%22%2C%20title%3D%22Category%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.Tooltip(%22total_revenue%3AQ%22%2C%20title%3D%22Revenue%20(%E2%82%AC)%22%2C%20format%3D%22%2C.0f%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20alt.Tooltip(%22share%3AN%22%2C%20title%3D%22Share%22)%2C%20%20%23%20e.g.%20%2227%25%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20%20%20%20%20%23%20.properties(width%3D500%2C%20height%3D500)%0A%20%20%20%20%20%20%20%20.properties(title%3D%22Relatieve%20total%20revenue%20for%20hierarchy1%22)%0A%20%20%20%20%20%20%20%20.configure_title(%0A%20%20%20%20%20%20%20%20%20%20%20%20fontSize%3D34%2C%20%20%20%20%20%23%20increase%20size%0A%20%20%20%20%20%20%20%20%20%20%20%20anchor%3D%22start%22%2C%20%20%23%20or%20%22middle%22%20for%20centered%0A%20%20%20%20%20%20%20%20%20%20%20%20fontWeight%3D%22bold%22%0A%20%20%20%20%20%20%20%20)%0A%20%20%20%20)%0A%0A%20%20%20%20chart%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20return%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A
</marimo-code>

<marimo-code-hash hidden="">0f9c0f875a83467d151a56b0bae1c2b12b0a2c5ad2fbfa836f31539983998526</marimo-code-hash>
</body>
</html>
